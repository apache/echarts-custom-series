/*
* Licensed to the Apache Software Foundation (ASF) under one
* or more contributor license agreements.  See the NOTICE file
* distributed with this work for additional information
* regarding copyright ownership.  The ASF licenses this file
* to you under the Apache License, Version 2.0 (the
* "License"); you may not use this file except in compliance
* with the License.  You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing,
* software distributed under the License is distributed on an
* "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
* KIND, either express or implied.  See the License for the
* specific language governing permissions and limitations
* under the License.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).stageCustomSeriesInstaller=e(t.echarts)}(this,(function(t){"use strict";var e=function(e,a){var o,c=a.value(0),i=a.value(1),n=a.value(2),h=a.coord([c,n]),r=a.coord([i,n]),l=a.coord([0,0])[1]-a.coord([0,1])[1],s=a.visual("color"),d=e.itemPayload,p=d.itemStyle||{},x=p.borderRadius||8,y=t.zrUtil.retrieve2(null===(o=d.envelope)||void 0===o?void 0:o.externalRadius,6),f=t.zrUtil.retrieve2(p.verticalMargin,8),u=t.zrUtil.retrieve2(p.minHorizontalSize,3),g=[],v=e.context.boxes||[],w=r[0]-h[0],m=Math.max(w,u),M={x:h[0]-(m-w)/2,y:h[1]-l/2+5+14+f,width:m,height:l-14-5-2*f};g.push({type:"rect",shape:{x:M.x,y:M.y,width:M.width,height:M.height,r:x},style:{fill:s},z2:10}),v.push(M),e.context.boxes=v,e.context.renderedStages||(e.context.renderedStages=[]);var L=e.context.renderedStages;if(!L[n]){var b=d.axisLabel||{},z=a.ordinalRawValue(2);"function"==typeof b.formatter&&(z=b.formatter(z,n)),g.push({type:"text",style:{x:e.coordSys.x+5,y:h[1]-l/2+5+14,fill:b.color||"#8A8A8A",text:z,verticalAlign:"bottom"},z2:20}),L[n]=!0}if(e.dataIndex===e.dataInsideLength-1){for(var S=[],A=0;A<e.dataInsideLength;A++){var U=a.visual("color",A);S.indexOf(U)<0&&S.push(U)}var D=d.envelope||{};if(!1!==D.show&&v.length>1){var I=[],Z=t.zrUtil.retrieve2(D.margin,2);v.sort((function(t,e){return t.x-e.x||t.y-e.y}));var R=D.color||"#888";if(S.length>0&&!D.color){var C=[];for(A=0;A<S.length;A++)C.push({offset:(2*A+1)/(2*S.length),color:S[A]});R={type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:C}}var P=t.zrUtil.retrieve2(D.opacity,.25);for(A=0;A<v.length;A++){var T=v[A];if(I.push({type:"rect",shape:{x:T.x-Z,y:T.y-Z,width:T.width+2*Z,height:T.height+2*Z,r:Math.min(x,T.width/2)+Z}}),A>0){var j=v[A-1],q=j.y>T.y+T.height,H=q?j.y-T.y-T.height+2*x:T.y-j.y-j.height+2*x,O=q?T.y+T.height-x:j.y+j.height-x;if(T.x-Z>=j.x+j.width+Z)continue;if(q){if(T.x-Z-j.x>0){var V=Math.ceil(T.x-Z),k=j.y-Z,B=Math.min((T.x-Z-j.x)/2,y);I.push({type:"path",shape:{pathData:"M".concat(V-B," ").concat(k,"A").concat(B," ").concat(B," 0 0 0 ").concat(V," ").concat(k-B,"L").concat(V,",").concat(k+Z,"L").concat(V-B,",").concat(k,"Z")}})}if(T.x+T.width-j.x-j.width-Z>0){var E=T.y+T.height+Z,F=Math.floor(j.x+j.width+Z);B=Math.min((T.x+T.width-j.x-j.width-Z)/2,y);I.push({type:"path",shape:{pathData:"M".concat(F+B," ").concat(E,"A").concat(B," ").concat(B," 0 0 0 ").concat(F," ").concat(E+B,"L").concat(F,",").concat(E-Z,"L").concat(F+B,",").concat(E,"Z")}})}}else{if(T.x-Z-j.x>0){V=Math.ceil(T.x-Z);var G=j.y+j.height+Z;B=Math.min((T.x-Z-j.x)/2,y);I.push({type:"path",shape:{pathData:"M".concat(V," ").concat(G+B,"A").concat(B," ").concat(B," 0 0 0 ").concat(V-B," ").concat(G,"L").concat(V,",").concat(G-Z,"L").concat(V,",").concat(G+B,"Z")}})}if(T.x+T.width-j.x-j.width-Z>0){k=T.y-Z,F=Math.floor(j.x+j.width+Z),B=Math.min((T.x+T.width-j.x-j.width-Z)/2,y);I.push({type:"path",shape:{pathData:"M".concat(F," ").concat(k-B,"A").concat(B," ").concat(B," 0 0 0 ").concat(F+B," ").concat(k,"L").concat(F,",").concat(k+Z,"L").concat(F,",").concat(k-B,"Z")}})}}I.push({type:"rect",shape:{x:j.x+j.width+Z,y:O+H,width:T.x-j.x-j.width-2*Z,height:-H}})}}g.push({type:"compoundPath",shape:{paths:I},style:{fill:R,opacity:P},silent:!0})}}return{type:"group",children:g}};return{install:function(t){t.registerCustomSeries("stage",e)}}}));