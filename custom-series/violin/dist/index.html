<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Path in Canvas</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            flex-direction: row;
        }

        canvas {
            border: 1px solid #000000;
            margin-bottom: 20px;
        }

        svg {
            border: 1px solid #000000;
        }
    </style>
</head>

<body>
    <script src="../node_modules/dynamics.js/lib/dynamics.js"></script>
    <canvas id="myCanvas" width="500" height="500"></canvas>
    <svg id="mySVG" width="500" height="500"></svg>
    <script>
        const generator = ({ size = 400, growth = 16, edges = 6, seed = null } = {}) => {
            var { destPoints, seedValue } = _createPoints(size, growth, edges, seed);
            var path = _createSvgPath(destPoints);
            return { path, seedValue };
        };

        const _toRad = (deg) => deg * (Math.PI / 180.0);

        const _divide = (count) => {
            var deg = 360 / count;

            return Array(count)
                .fill("a")
                .map((_, i) => i * deg);
        };

        const _randomDoubleGenerator = (s) => {
            var mask = 0xffffffff;
            var m_w = (123456789 + s) & mask;
            var m_z = (987654321 - s) & mask;

            return function () {
                m_z = (36969 * (m_z & 65535) + (m_z >>> 16)) & mask;
                m_w = (18000 * (m_w & 65535) + (m_w >>> 16)) & mask;

                var result = ((m_z << 16) + (m_w & 65535)) >>> 0;
                result /= 4294967296;
                return result;
            };
        };

        const _magicPoint = (value, min, max) => {
            let radius = min + value * (max - min);
            if (radius > max) {
                radius = radius - min;
            } else if (radius < min) {
                radius = radius + min;
            }
            return radius;
        };

        const _point = (origin, radius, degree) => {
            var x = origin + radius * Math.cos(_toRad(degree));
            var y = origin + radius * Math.sin(_toRad(degree));
            return [Math.round(x), Math.round(y)];
        };

        const _shuffle = (array) => {
            array.sort(() => Math.random() - 0.5);
            return array;
        };

        const _createPoints = (size, minGrowth, edgesCount, seed) => {
            let outerRad = size / 2;
            let innerRad = minGrowth * (outerRad / 10);
            let center = size / 2;

            let slices = _divide(edgesCount);
            let maxRandomValue = _shuffle([99, 999, 9999, 99999, 999999])[0];
            let id = Math.floor(Math.random() * maxRandomValue);
            let seedValue = seed || id;
            let randVal = _randomDoubleGenerator(seedValue);
            let destPoints = [];

            slices.forEach((degree) => {
                let O = _magicPoint(randVal(), innerRad, outerRad);
                let end = _point(center, O, degree);
                destPoints.push(end);
            });
            return { destPoints, seedValue };
        };

        const _createSvgPath = (points) => {
            let svgPath = "";
            var mid = [
                (points[0][0] + points[1][0]) / 2,
                (points[0][1] + points[1][1]) / 2,
            ];
            svgPath += "M" + mid[0] + "," + mid[1];

            for (var i = 0; i < points.length; i++) {
                var p1 = points[(i + 1) % points.length];
                var p2 = points[(i + 2) % points.length];
                mid = [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2];
                svgPath += "Q" + p1[0] + "," + p1[1] + "," + mid[0] + "," + mid[1];
            }
            svgPath += "Z";
            return svgPath;
        };

        window.onload = function () {
            const canvas = document.getElementById('myCanvas');
            const context = canvas.getContext('2d');
            const svg = document.getElementById('mySVG');

            // Define the SVG path data
            const svgPathData = generator({ size: 400, growth: 6, edges: 6, seed: null });
            console.log(svgPathData);

            // Draw on Canvas
            const path = new Path2D(svgPathData.path);
            context.strokeStyle = 'black';
            context.lineWidth = 2;
            context.stroke(path);

            // Draw on SVG
            const svgPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
            svgPath.setAttribute("d", svgPathData.path);
            svgPath.setAttribute("stroke", "black");
            svgPath.setAttribute("stroke-width", "2");
            svgPath.setAttribute("fill", "none");
            svg.appendChild(svgPath);


            dynamics.animate(svgPath, {
                d: generator({ size: 400, growth: 6, edges: 6, seed: null }).path
            }, {
                type: dynamics.easeInOut,
                duration: 2000,
                friction: 100,
                complete: function () {
                    console.log('Animation completed');
                }
            });
        };
    </script>
</body>

</html>